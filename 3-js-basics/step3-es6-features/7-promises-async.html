<!DOCTYPE html>
<html>
<head>
<meta charset="UTF-8">
<title>ES6+ Promise, async/await, fetch ê¸°ì´ˆ</title>
</head>
<body>
ES6+ ë¹„ë™ê¸° ì²˜ë¦¬: Promise â†’ async/await â†’ fetchë¡œ ê¹”ë”í•œ ë¹„ë™ê¸° ì½”ë“œ ì‘ì„±
<br><br>

<button onclick="promiseBasic()">Promise ê¸°ì´ˆ</button>
<button onclick="asyncAwaitBasic()">async/await ê¸°ì´ˆ</button>
<button onclick="fetchBasic()">fetch ê¸°ì´ˆ</button>
<button onclick="springApiExample()">Spring API ì—°ë™</button>

<script>
    // ğŸ¯ í•™ìŠµ ëª©í‘œ: ë¹„ë™ê¸° ì²˜ë¦¬ ë°©ì‹ì˜ ì§„í™” ê³¼ì • ì´í•´í•˜ê¸°
    // ğŸ’¡ í•µì‹¬ ê°œë…:
    // - Promise: ì½œë°± ì§€ì˜¥ì„ í•´ê²°í•˜ê³  ë¹„ë™ê¸° ì‘ì—…ì˜ ì„±ê³µ/ì‹¤íŒ¨ë¥¼ ëª…í™•íˆ ì²˜ë¦¬
    // - async/await: Promiseë¥¼ ë” ì§ê´€ì ìœ¼ë¡œ ì‚¬ìš©í•  ìˆ˜ ìˆëŠ” ë¬¸ë²•ì  ì„¤íƒ•
    // - fetch: XMLHttpRequestë¥¼ ëŒ€ì²´í•˜ëŠ” í˜„ëŒ€ì ì¸ HTTP í†µì‹  API
    // - Spring Bootì™€ í”„ë¡ íŠ¸ì—”ë“œ ì—°ë™ì˜ í•µì‹¬ ê¸°ìˆ 

    function promiseBasic() {
        console.log("=== Promise ê¸°ì´ˆ ===");
        
        // ğŸ” Promiseë€ ë¬´ì—‡ì¸ê°€?
        // ë¹„ë™ê¸° ì‘ì—…ì˜ "ì•½ì†"ì„ ë‚˜íƒ€ë‚´ëŠ” ê°ì²´
        // 3ê°€ì§€ ìƒíƒœ: pending(ëŒ€ê¸°) â†’ fulfilled(ì„±ê³µ) or rejected(ì‹¤íŒ¨)
        // ì½œë°± ì§€ì˜¥ì„ í•´ê²°í•˜ê³  ë¹„ë™ê¸° ì½”ë“œë¥¼ ë” ì½ê¸° ì‰½ê²Œ ë§Œë“¦
        
        // 1ï¸âƒ£ Promise ìƒì„±: new Promise((resolve, reject) => {})
        // resolve: ì„±ê³µ ì‹œ í˜¸ì¶œ, reject: ì‹¤íŒ¨ ì‹œ í˜¸ì¶œ
        // ì‹¤ë¬´ì—ì„œëŠ” ì§ì ‘ ìƒì„±ë³´ë‹¤ëŠ” fetch, axios ë“±ì´ ë°˜í™˜í•˜ëŠ” Promise ì‚¬ìš©
        const simplePromise = new Promise((resolve, reject) => {
            // ë¹„ë™ê¸° ì‘ì—… ì‹œë®¬ë ˆì´ì…˜ (ì˜ˆ: ì„œë²„ ì‘ë‹µ ëŒ€ê¸°)
            setTimeout(() => {
                const success = Math.random() > 0.3; // 70% ì„±ê³µ í™•ë¥ 
                
                if (success) {
                    resolve("ë°ì´í„° ë¡œë”© ì„±ê³µ!"); // ì„±ê³µ ì‹œ ê²°ê³¼ê°’ ì „ë‹¬
                } else {
                    reject(new Error("ë„¤íŠ¸ì›Œí¬ ì˜¤ë¥˜ ë°œìƒ")); // ì‹¤íŒ¨ ì‹œ ì—ëŸ¬ ì „ë‹¬
                }
            }, 1000);
        });
        
        // 2ï¸âƒ£ Promise ì‚¬ìš©: .then()ê³¼ .catch()
        // .then(): ì„±ê³µí–ˆì„ ë•Œ ì‹¤í–‰í•  í•¨ìˆ˜ (resolveì˜ ê°’ì„ ë°›ìŒ)
        // .catch(): ì‹¤íŒ¨í–ˆì„ ë•Œ ì‹¤í–‰í•  í•¨ìˆ˜ (rejectì˜ ì—ëŸ¬ë¥¼ ë°›ìŒ)
        // .finally(): ì„±ê³µ/ì‹¤íŒ¨ì™€ ê´€ê³„ì—†ì´ í•­ìƒ ì‹¤í–‰ (ì •ë¦¬ ì‘ì—…ìš©)
        simplePromise
            .then(result => {
                console.log("âœ… ì„±ê³µ:", result);
                return "ì²˜ë¦¬ ì™„ë£Œ"; // ë‹¤ìŒ thenìœ¼ë¡œ ê°’ ì „ë‹¬ ê°€ëŠ¥
            })
            .then(nextResult => {
                console.log("âœ… ì—°ì† ì²˜ë¦¬:", nextResult);
            })
            .catch(error => {
                console.log("âŒ ì‹¤íŒ¨:", error.message);
            })
            .finally(() => {
                console.log("ğŸ”„ ì‘ì—… ì™„ë£Œ (ì„±ê³µ/ì‹¤íŒ¨ ë¬´ê´€)");
            });
        
        // 3ï¸âƒ£ ì‹¤ë¬´ ì‹œë®¬ë ˆì´ì…˜: ì‚¬ìš©ì ë°ì´í„° ê°€ì ¸ì˜¤ê¸°
        // ì‹¤ì œë¡œëŠ” ì„œë²„ APIë¥¼ í˜¸ì¶œí•˜ì§€ë§Œ, ì—¬ê¸°ì„œëŠ” ì‹œë®¬ë ˆì´ì…˜
        function fetchUserData(userId) {
            return new Promise((resolve, reject) => {
                console.log(`ğŸ‘¤ ì‚¬ìš©ì ${userId} ë°ì´í„° ìš”ì²­ ì¤‘...`);
                
                setTimeout(() => {
                    if (userId <= 0) {
                        reject(new Error("ìœ íš¨í•˜ì§€ ì•Šì€ ì‚¬ìš©ì ID"));
                        return;
                    }
                    
                    // ê°€ì§œ ì‚¬ìš©ì ë°ì´í„° ë°˜í™˜
                    const userData = {
                        id: userId,
                        name: `ì‚¬ìš©ì${userId}`,
                        email: `user${userId}@example.com`,
                        joinDate: new Date().toISOString()
                    };
                    
                    resolve(userData);
                }, 800);
            });
        }
        
        // Promise ì²´ì´ë‹: ì—¬ëŸ¬ ë¹„ë™ê¸° ì‘ì—…ì„ ìˆœì°¨ì ìœ¼ë¡œ ì²˜ë¦¬
        fetchUserData(1)
            .then(user => {
                console.log("ğŸ“‹ ì‚¬ìš©ì ì •ë³´:", user);
                // ì‚¬ìš©ì ì •ë³´ë¥¼ ë°”íƒ•ìœ¼ë¡œ ì¶”ê°€ ë°ì´í„° ìš”ì²­
                return fetchUserData(user.id + 1); // ë‹¤ìŒ ì‚¬ìš©ì ì •ë³´ë„ ìš”ì²­
            })
            .then(nextUser => {
                console.log("ğŸ“‹ ë‹¤ìŒ ì‚¬ìš©ì:", nextUser);
            })
            .catch(error => {
                console.log("ğŸš¨ ì‚¬ìš©ì ì¡°íšŒ ì‹¤íŒ¨:", error.message);
            });
        
        // 4ï¸âƒ£ Promise.all(): ì—¬ëŸ¬ Promiseë¥¼ ë™ì‹œì— ì‹¤í–‰
        // ëª¨ë“  Promiseê°€ ì„±ê³µí•´ì•¼ ì„±ê³µ, í•˜ë‚˜ë¼ë„ ì‹¤íŒ¨í•˜ë©´ ì‹¤íŒ¨
        // ì—¬ëŸ¬ APIë¥¼ ë™ì‹œì— í˜¸ì¶œí•  ë•Œ ë§¤ìš° ìœ ìš© (ì„±ëŠ¥ í–¥ìƒ)
        const users = Promise.all([
            fetchUserData(1),
            fetchUserData(2),
            fetchUserData(3)
        ]);
        
        users
            .then(allUsers => {
                console.log("ğŸ‘¥ ëª¨ë“  ì‚¬ìš©ì:", allUsers);
                console.log(`ì´ ${allUsers.length}ëª…ì˜ ì‚¬ìš©ì ì¡°íšŒ ì™„ë£Œ`);
            })
            .catch(error => {
                console.log("ğŸš¨ ì¼ë¶€ ì‚¬ìš©ì ì¡°íšŒ ì‹¤íŒ¨:", error.message);
            });
        
        alert("ì½˜ì†”ì—ì„œ Promise ë™ì‘ì„ í™•ì¸í•˜ì„¸ìš”! (1ì´ˆ í›„ ê²°ê³¼ í‘œì‹œ)");
    }
    
    function asyncAwaitBasic() {
        console.log("=== async/await ê¸°ì´ˆ ===");
        
        // ğŸ” async/awaitë€?
        // Promiseë¥¼ ë” ì½ê¸° ì‰½ê²Œ ì‚¬ìš©í•  ìˆ˜ ìˆëŠ” ES2017 ë¬¸ë²•
        // async í•¨ìˆ˜ ì•ˆì—ì„œ await í‚¤ì›Œë“œë¡œ Promiseë¥¼ ë™ê¸° ì½”ë“œì²˜ëŸ¼ ì‘ì„±
        // try-catchë¡œ ì—ëŸ¬ ì²˜ë¦¬ê°€ ê°€ëŠ¥í•´ì ¸ì„œ ë” ì§ê´€ì 
        
        // ì´ì „ ì˜ˆì œì˜ ì‚¬ìš©ì ë°ì´í„° í•¨ìˆ˜ ì¬ì‚¬ìš©
        function fetchUserData(userId) {
            return new Promise((resolve, reject) => {
                setTimeout(() => {
                    if (userId <= 0) {
                        reject(new Error("ìœ íš¨í•˜ì§€ ì•Šì€ ì‚¬ìš©ì ID"));
                        return;
                    }
                    
                    resolve({
                        id: userId,
                        name: `ì‚¬ìš©ì${userId}`,
                        email: `user${userId}@example.com`,
                        department: userId % 2 === 0 ? "ê°œë°œíŒ€" : "ë””ìì¸íŒ€"
                    });
                }, 500);
            });
        }
        
        // 1ï¸âƒ£ async í•¨ìˆ˜ ì„ ì–¸: function ì•ì— async í‚¤ì›Œë“œ
        // async í•¨ìˆ˜ëŠ” í•­ìƒ Promiseë¥¼ ë°˜í™˜í•¨
        // ë‚´ë¶€ì—ì„œ returní•œ ê°’ì€ ìë™ìœ¼ë¡œ resolveë¨
        async function getUserInfo(userId) {
            try {
                console.log(`ğŸ” ì‚¬ìš©ì ${userId} ì¡°íšŒ ì‹œì‘`);
                
                // await: Promiseê°€ ì™„ë£Œë  ë•Œê¹Œì§€ ê¸°ë‹¤ë¦¼ (ë§ˆì¹˜ ë™ê¸° ì½”ë“œì²˜ëŸ¼!)
                // .then() ì—†ì´ë„ Promiseì˜ ê²°ê³¼ê°’ì„ ë°”ë¡œ ë³€ìˆ˜ì— í• ë‹¹
                const user = await fetchUserData(userId);
                console.log("âœ… ì‚¬ìš©ì ì¡°íšŒ ì™„ë£Œ:", user.name);
                
                return user; // ì´ ê°’ì€ Promise.resolve(user)ì™€ ë™ì¼
                
            } catch (error) {
                // Promiseê°€ rejectë˜ë©´ ì—¬ê¸°ì„œ catchë¨
                console.log("âŒ ì‚¬ìš©ì ì¡°íšŒ ì‹¤íŒ¨:", error.message);
                throw error; // ì—ëŸ¬ë¥¼ ë‹¤ì‹œ ë˜ì ¸ì„œ í˜¸ì¶œìê°€ ì²˜ë¦¬í•  ìˆ˜ ìˆê²Œ í•¨
            }
        }
        
        // 2ï¸âƒ£ async í•¨ìˆ˜ í˜¸ì¶œ: ì—¬ì „íˆ Promiseë¥¼ ë°˜í™˜í•˜ë¯€ë¡œ await ë˜ëŠ” .then() ì‚¬ìš©
        async function demonstrateAsyncAwait() {
            try {
                // ìˆœì°¨ì  ì²˜ë¦¬: í•˜ë‚˜ì”© ì°¨ë¡€ëŒ€ë¡œ ì‹¤í–‰
                console.log("=== ìˆœì°¨ì  ì‚¬ìš©ì ì¡°íšŒ ===");
                const user1 = await getUserInfo(1);
                const user2 = await getUserInfo(2);
                
                console.log("ğŸ¯ ì¡°íšŒ ì™„ë£Œ:", user1.name, user2.name);
                
                // ë³‘ë ¬ ì²˜ë¦¬: ë™ì‹œì— ì—¬ëŸ¬ ì‘ì—… ì‹¤í–‰ (ë” ë¹ ë¦„!)
                console.log("=== ë³‘ë ¬ ì‚¬ìš©ì ì¡°íšŒ ===");
                const [user3, user4, user5] = await Promise.all([
                    getUserInfo(3),
                    getUserInfo(4),
                    getUserInfo(5)
                ]);
                
                console.log("ğŸš€ ë³‘ë ¬ ì¡°íšŒ ì™„ë£Œ:", user3.name, user4.name, user5.name);
                
            } catch (error) {
                console.log("ğŸš¨ ì „ì²´ ì‘ì—… ì‹¤íŒ¨:", error.message);
            }
        }
        
        // 3ï¸âƒ£ ì‹¤ë¬´ íŒ¨í„´: ë°ì´í„° ê°€ê³µê³¼ ì—ëŸ¬ ì²˜ë¦¬
        async function processUserData() {
            try {
                console.log("=== ì‚¬ìš©ì ë°ì´í„° ê°€ê³µ ===");
                
                // 1ë‹¨ê³„: ì‚¬ìš©ì ëª©ë¡ ì¡°íšŒ
                const userIds = [1, 2, 3];
                const users = await Promise.all(
                    userIds.map(id => getUserInfo(id))
                );
                
                // 2ë‹¨ê³„: ë°ì´í„° ê°€ê³µ (ë¶€ì„œë³„ ê·¸ë£¹í™”)
                const groupedUsers = users.reduce((groups, user) => {
                    const dept = user.department;
                    if (!groups[dept]) groups[dept] = [];
                    groups[dept].push(user);
                    return groups;
                }, {});
                
                console.log("ğŸ“Š ë¶€ì„œë³„ ì‚¬ìš©ì:", groupedUsers);
                
                // 3ë‹¨ê³„: í†µê³„ ê³„ì‚°
                const stats = Object.entries(groupedUsers).map(([dept, members]) => ({
                    department: dept,
                    count: members.length,
                    members: members.map(u => u.name)
                }));
                
                console.log("ğŸ“ˆ ë¶€ì„œë³„ í†µê³„:", stats);
                
                return { users, groupedUsers, stats };
                
            } catch (error) {
                console.log("ğŸš¨ ë°ì´í„° ì²˜ë¦¬ ì‹¤íŒ¨:", error.message);
                return null;
            }
        }
        
        // 4ï¸âƒ£ í™”ì‚´í‘œ í•¨ìˆ˜ì™€ async/await
        // í™”ì‚´í‘œ í•¨ìˆ˜ì—ì„œë„ async ì‚¬ìš© ê°€ëŠ¥ (Reactì—ì„œ ìì£¼ ì‚¬ìš©í•˜ëŠ” íŒ¨í„´)
        const quickUserCheck = async (userId) => {
            try {
                const user = await getUserInfo(userId);
                return `${user.name}ë‹˜ (${user.department})`;
            } catch (error) {
                return `ì‚¬ìš©ì ${userId} ì¡°íšŒ ì‹¤íŒ¨`;
            }
        };
        
        // ëª¨ë“  í•¨ìˆ˜ ì‹¤í–‰
        demonstrateAsyncAwait();
        processUserData();
        
        // í™”ì‚´í‘œ í•¨ìˆ˜ í…ŒìŠ¤íŠ¸
        quickUserCheck(1).then(result => console.log("ğŸ¯ ë¹ ë¥¸ ì¡°íšŒ:", result));
        
        alert("ì½˜ì†”ì—ì„œ async/await ë™ì‘ì„ í™•ì¸í•˜ì„¸ìš”!");
    }
    
    function fetchBasic() {
        console.log("=== fetch ê¸°ì´ˆ ===");
        
        // ğŸ” fetchë€?
        // ë¸Œë¼ìš°ì € ë‚´ì¥ APIë¡œ HTTP ìš”ì²­ì„ ë³´ë‚´ëŠ” í˜„ëŒ€ì ì¸ ë°©ë²•
        // XMLHttpRequestë¥¼ ëŒ€ì²´í•˜ë©°, Promise ê¸°ë°˜ìœ¼ë¡œ ë” ê¹”ë”í•œ ì½”ë“œ ì‘ì„±
        // Spring Boot Controllerì™€ í†µì‹ í•  ë•Œ ê°€ì¥ ë§ì´ ì‚¬ìš©í•˜ëŠ” ë°©ë²•
        
        // 1ï¸âƒ£ ê¸°ë³¸ GET ìš”ì²­
        // fetch()ëŠ” í•­ìƒ Promiseë¥¼ ë°˜í™˜
        // ì‘ë‹µ ê°ì²´(Response)ë¥¼ ë°›ì€ í›„ .json(), .text() ë“±ìœ¼ë¡œ ë°ì´í„° ì¶”ì¶œ
        async function basicFetchExample() {
            try {
                console.log("=== ê¸°ë³¸ fetch ì‚¬ìš©ë²• ===");
                
                // ê³µê°œ APIë¥¼ ì‚¬ìš©í•œ ì‹¤ì œ ì˜ˆì œ (JSONPlaceholder)
                const response = await fetch('https://jsonplaceholder.typicode.com/users/1');
                
                // ğŸ” Response ê°ì²´ í™•ì¸
                console.log("ğŸ“¡ ì‘ë‹µ ìƒíƒœ:", response.status); // 200, 404, 500 ë“±
                console.log("ğŸ“¡ ì‘ë‹µ ì„±ê³µ ì—¬ë¶€:", response.ok); // 200-299 ë²”ìœ„ë©´ true
                
                // ì‘ë‹µì´ ì„±ê³µì ì´ì§€ ì•Šìœ¼ë©´ ì—ëŸ¬ ë°œìƒì‹œí‚¤ê¸°
                if (!response.ok) {
                    throw new Error(`HTTP ì˜¤ë¥˜! ìƒíƒœ: ${response.status}`);
                }
                
                // JSON ë°ì´í„° ì¶”ì¶œ (Spring Controllerì˜ @ResponseBodyì™€ ë™ì¼)
                const user = await response.json();
                console.log("ğŸ‘¤ ë°›ì€ ì‚¬ìš©ì ë°ì´í„°:", user);
                
                return user;
                
            } catch (error) {
                console.log("ğŸš¨ fetch ì‹¤íŒ¨:", error.message);
                return null;
            }
        }
        
        // 2ï¸âƒ£ POST ìš”ì²­ (Spring Controllerë¡œ ë°ì´í„° ì „ì†¡)
        // ë‘ ë²ˆì§¸ ë§¤ê°œë³€ìˆ˜ì— ì˜µì…˜ ê°ì²´ë¥¼ ì „ë‹¬í•´ì„œ HTTP ë©”ì„œë“œ, í—¤ë”, ë°”ë”” ì„¤ì •
        async function postData(userData) {
            try {
                console.log("=== POST ìš”ì²­ (ë°ì´í„° ì „ì†¡) ===");
                
                const response = await fetch('https://jsonplaceholder.typicode.com/users', {
                    method: 'POST', // HTTP ë©”ì„œë“œ ì§€ì •
                    headers: {
                        'Content-Type': 'application/json', // Spring @RequestBodyì™€ ë§¤ì¹­
                        'Accept': 'application/json'        // JSON ì‘ë‹µ ìš”ì²­
                    },
                    body: JSON.stringify(userData) // ê°ì²´ë¥¼ JSON ë¬¸ìì—´ë¡œ ë³€í™˜
                });
                
                if (!response.ok) {
                    throw new Error(`POST ì‹¤íŒ¨: ${response.status}`);
                }
                
                const result = await response.json();
                console.log("ğŸ“¤ ì „ì†¡ ì„±ê³µ:", result);
                
                return result;
                
            } catch (error) {
                console.log("ğŸš¨ POST ì‹¤íŒ¨:", error.message);
                throw error;
            }
        }
        
        // 3ï¸âƒ£ PUT/DELETE ìš”ì²­ (RESTful API íŒ¨í„´)
        async function updateUser(userId, updates) {
            try {
                const response = await fetch(`https://jsonplaceholder.typicode.com/users/${userId}`, {
                    method: 'PUT',
                    headers: {
                        'Content-Type': 'application/json'
                    },
                    body: JSON.stringify(updates)
                });
                
                const result = await response.json();
                console.log("ğŸ“ ì—…ë°ì´íŠ¸ ì„±ê³µ:", result);
                return result;
                
            } catch (error) {
                console.log("ğŸš¨ ì—…ë°ì´íŠ¸ ì‹¤íŒ¨:", error.message);
            }
        }
        
        async function deleteUser(userId) {
            try {
                const response = await fetch(`https://jsonplaceholder.typicode.com/users/${userId}`, {
                    method: 'DELETE'
                });
                
                if (response.ok) {
                    console.log(`ğŸ—‘ï¸ ì‚¬ìš©ì ${userId} ì‚­ì œ ì„±ê³µ`);
                }
                
            } catch (error) {
                console.log("ğŸš¨ ì‚­ì œ ì‹¤íŒ¨:", error.message);
            }
        }
        
        // 4ï¸âƒ£ ì‹¤ë¬´ íŒ¨í„´: API ì„œë¹„ìŠ¤ í´ë˜ìŠ¤
        class ApiService {
            constructor(baseUrl) {
                this.baseUrl = baseUrl;
            }
            
            // ê³µí†µ fetch ë˜í¼ ë©”ì„œë“œ
            async request(endpoint, options = {}) {
                const url = `${this.baseUrl}${endpoint}`;
                
                // ê¸°ë³¸ ì˜µì…˜ ì„¤ì •
                const config = {
                    headers: {
                        'Content-Type': 'application/json',
                        ...options.headers // ì¶”ê°€ í—¤ë” ë³‘í•©
                    },
                    ...options
                };
                
                try {
                    console.log(`ğŸŒ API ìš”ì²­: ${config.method || 'GET'} ${url}`);
                    
                    const response = await fetch(url, config);
                    
                    if (!response.ok) {
                        throw new Error(`API ì˜¤ë¥˜: ${response.status} ${response.statusText}`);
                    }
                    
                    // ì‘ë‹µì´ JSONì¸ì§€ í™•ì¸ í›„ íŒŒì‹±
                    const contentType = response.headers.get('content-type');
                    if (contentType && contentType.includes('application/json')) {
                        return await response.json();
                    } else {
                        return await response.text();
                    }
                    
                } catch (error) {
                    console.log(`ğŸš¨ API ìš”ì²­ ì‹¤íŒ¨: ${error.message}`);
                    throw error;
                }
            }
            
            // CRUD ë©”ì„œë“œë“¤
            async get(endpoint) {
                return this.request(endpoint);
            }
            
            async post(endpoint, data) {
                return this.request(endpoint, {
                    method: 'POST',
                    body: JSON.stringify(data)
                });
            }
            
            async put(endpoint, data) {
                return this.request(endpoint, {
                    method: 'PUT',
                    body: JSON.stringify(data)
                });
            }
            
            async delete(endpoint) {
                return this.request(endpoint, {
                    method: 'DELETE'
                });
            }
        }
        
        // 5ï¸âƒ£ API ì„œë¹„ìŠ¤ ì‚¬ìš© ì˜ˆì œ
        async function demonstrateApiService() {
            const api = new ApiService('https://jsonplaceholder.typicode.com');
            
            try {
                // ì‚¬ìš©ì ëª©ë¡ ì¡°íšŒ
                const users = await api.get('/users');
                console.log(`ğŸ“‹ ì‚¬ìš©ì ${users.length}ëª… ì¡°íšŒë¨`);
                
                // ìƒˆ ì‚¬ìš©ì ìƒì„±
                const newUser = await api.post('/users', {
                    name: 'ê¹€ê°œë°œ',
                    email: 'dev@example.com',
                    phone: '010-1234-5678'
                });
                console.log("âœ¨ ìƒˆ ì‚¬ìš©ì ìƒì„±:", newUser);
                
                // ì‚¬ìš©ì ì •ë³´ ìˆ˜ì •
                const updatedUser = await api.put('/users/1', {
                    name: 'ê¹€ìˆ˜ì •',
                    email: 'updated@example.com'
                });
                console.log("ğŸ“ ì‚¬ìš©ì ì •ë³´ ìˆ˜ì •:", updatedUser);
                
            } catch (error) {
                console.log("ğŸš¨ API ì„œë¹„ìŠ¤ ì˜¤ë¥˜:", error.message);
            }
        }
        
        // ëª¨ë“  ì˜ˆì œ ì‹¤í–‰
        basicFetchExample();
        
        // POST ì˜ˆì œ
        postData({
            name: 'ë°•ì‹ ì…',
            email: 'new@example.com',
            website: 'new-dev.com'
        });
        
        // API ì„œë¹„ìŠ¤ ì˜ˆì œ
        demonstrateApiService();
        
        alert("ì½˜ì†”ì—ì„œ fetch API ë™ì‘ì„ í™•ì¸í•˜ì„¸ìš”! (ì‹¤ì œ HTTP ìš”ì²­ ë°œìƒ)");
    }
    
    function springApiExample() {
        console.log("=== Spring Boot API ì—°ë™ ì‹¤ë¬´ ì˜ˆì œ ===");
        
        // ğŸŒ± ì‹¤ì œ Spring Boot í”„ë¡œì íŠ¸ì™€ ì—°ë™í•˜ëŠ” íŒ¨í„´
        // Controller, Service, Repository êµ¬ì¡°ë¥¼ ê³ ë ¤í•œ í”„ë¡ íŠ¸ì—”ë“œ ì½”ë“œ
        
        // 1ï¸âƒ£ Spring Boot API ì„œë¹„ìŠ¤ í´ë˜ìŠ¤
        class SpringApiService {
            constructor() {
                // ì‹¤ì œ Spring Boot ì„œë²„ ì£¼ì†Œ (ê°œë°œí™˜ê²½ ê¸°ì¤€)
                this.baseUrl = 'http://localhost:8080/api';
                this.defaultHeaders = {
                    'Content-Type': 'application/json',
                    'Accept': 'application/json'
                };
            }
            
            // Spring Security JWT í† í° í—¤ë” ì¶”ê°€
            getAuthHeaders() {
                const token = localStorage.getItem('jwt-token'); // ì‹¤ì œë¡œëŠ” ì‚¬ìš© ê¸ˆì§€
                return token ? {
                    ...this.defaultHeaders,
                    'Authorization': `Bearer ${token}`
                } : this.defaultHeaders;
            }
            
            // ê³µí†µ ì—ëŸ¬ ì²˜ë¦¬
            async handleResponse(response) {
                if (!response.ok) {
                    // Spring Bootì˜ GlobalExceptionHandler ì‘ë‹µ í˜•ì‹
                    const errorData = await response.json().catch(() => ({}));
                    const error = new Error(errorData.message || `HTTP ${response.status}`);
                    error.status = response.status;
                    error.data = errorData;
                    throw error;
                }
                
                // ì‘ë‹µ íƒ€ì…ì— ë”°ë¥¸ ì²˜ë¦¬
                const contentType = response.headers.get('content-type');
                if (contentType?.includes('application/json')) {
                    return response.json();
                }
                return response.text();
            }
            
            // ì‚¬ìš©ì ê´€ë ¨ API (@RestController UserController)
            async getUsers(page = 0, size = 10, sort = 'id') {
                try {
                    // Spring Data JPA Pageable íŒŒë¼ë¯¸í„°
                    const params = new URLSearchParams({ page, size, sort });
                    const response = await fetch(`${this.baseUrl}/users?${params}`, {
                        method: 'GET',
                        headers: this.getAuthHeaders()
                    });
                    
                    const data = await this.handleResponse(response);
                    console.log("ğŸ“‹ ì‚¬ìš©ì ëª©ë¡ ì¡°íšŒ ì„±ê³µ:", data);
                    return data;
                    
                } catch (error) {
                    console.log("ğŸš¨ ì‚¬ìš©ì ëª©ë¡ ì¡°íšŒ ì‹¤íŒ¨:", error.message);
                    throw error;
                }
            }
            
            async createUser(userData) {
                try {
                    // Spring Controllerì˜ @RequestBodyë¡œ ì „ì†¡
                    const response = await fetch(`${this.baseUrl}/users`, {
                        method: 'POST',
                        headers: this.getAuthHeaders(),
                        body: JSON.stringify(userData)
                    });
                    
                    const result = await this.handleResponse(response);
                    console.log("âœ¨ ì‚¬ìš©ì ìƒì„± ì„±ê³µ:", result);
                    return result;
                    
                } catch (error) {
                    console.log("ğŸš¨ ì‚¬ìš©ì ìƒì„± ì‹¤íŒ¨:", error.message);
                    throw error;
                }
            }
            
            async updateUser(userId, updates) {
                try {
                    const response = await fetch(`${this.baseUrl}/users/${userId}`, {
                        method: 'PUT',
                        headers: this.getAuthHeaders(),
                        body: JSON.stringify(updates)
                    });
                    
                    const result = await this.handleResponse(response);
                    console.log("ğŸ“ ì‚¬ìš©ì ì—…ë°ì´íŠ¸ ì„±ê³µ:", result);
                    return result;
                    
                } catch (error) {
                    console.log("ğŸš¨ ì‚¬ìš©ì ì—…ë°ì´íŠ¸ ì‹¤íŒ¨:", error.message);
                    throw error;
                }
            }
            
            // íŒŒì¼ ì—…ë¡œë“œ (@RequestParam MultipartFile)
            async uploadFile(file, userId) {
                try {
                    const formData = new FormData();
                    formData.append('file', file);
                    formData.append('userId', userId);
                    
                    const response = await fetch(`${this.baseUrl}/users/upload`, {
                        method: 'POST',
                        headers: {
                            'Authorization': this.getAuthHeaders().Authorization
                            // Content-Typeì€ FormData ì‚¬ìš© ì‹œ ìë™ ì„¤ì •
                        },
                        body: formData
                    });
                    
                    const result = await this.handleResponse(response);
                    console.log("ğŸ“ íŒŒì¼ ì—…ë¡œë“œ ì„±ê³µ:", result);
                    return result;
                    
                } catch (error) {
                    console.log("ğŸš¨ íŒŒì¼ ì—…ë¡œë“œ ì‹¤íŒ¨:", error.message);
                    throw error;
                }
            }
        }
        
        // 2ï¸âƒ£ í¼ ì²˜ë¦¬ì™€ ìœ íš¨ì„± ê²€ì‚¬
        class UserFormHandler {
            constructor(apiService) {
                this.api = apiService;
            }
            
            // í¼ ë°ì´í„° ê²€ì¦ (Spring Validationê³¼ ìœ ì‚¬)
            validateUser(userData) {
                const errors = [];
                
                if (!userData.name || userData.name.trim().length < 2) {
                    errors.push("ì´ë¦„ì€ 2ì ì´ìƒì´ì–´ì•¼ í•©ë‹ˆë‹¤");
                }
                
                if (!userData.email || !userData.email.includes('@')) {
                    errors.push("ìœ íš¨í•œ ì´ë©”ì¼ ì£¼ì†Œê°€ í•„ìš”í•©ë‹ˆë‹¤");
                }
                
                if (!userData.age || userData.age < 1 || userData.age > 150) {
                    errors.push("ë‚˜ì´ëŠ” 1-150 ì‚¬ì´ì—¬ì•¼ í•©ë‹ˆë‹¤");
                }
                
                return {
                    isValid: errors.length === 0,
                    errors
                };
            }
            
            // ì‚¬ìš©ì ë“±ë¡ ì²˜ë¦¬
            async handleUserRegistration(formData) {
                try {
                    console.log("=== ì‚¬ìš©ì ë“±ë¡ ì²˜ë¦¬ ===");
                    
                    // 1ë‹¨ê³„: í´ë¼ì´ì–¸íŠ¸ ì¸¡ ìœ íš¨ì„± ê²€ì‚¬
                    const validation = this.validateUser(formData);
                    if (!validation.isValid) {
                        return {
                            success: false,
                            errors: validation.errors
                        };
                    }
                    
                    // 2ë‹¨ê³„: ì„œë²„ë¡œ ë°ì´í„° ì „ì†¡
                    const result = await this.api.createUser(formData);
                    
                    return {
                        success: true,
                        data: result,
                        message: "ì‚¬ìš©ìê°€ ì„±ê³µì ìœ¼ë¡œ ë“±ë¡ë˜ì—ˆìŠµë‹ˆë‹¤"
                    };
                    
                } catch (error) {
                    // Spring Boot ì—ëŸ¬ ì‘ë‹µ ì²˜ë¦¬
                    if (error.status === 400) {
                        return {
                            success: false,
                            errors: ["ì„œë²„ ìœ íš¨ì„± ê²€ì‚¬ ì‹¤íŒ¨"],
                            serverErrors: error.data
                        };
                    } else if (error.status === 409) {
                        return {
                            success: false,
                            errors: ["ì´ë¯¸ ì¡´ì¬í•˜ëŠ” ì´ë©”ì¼ì…ë‹ˆë‹¤"]
                        };
                    } else {
                        return {
                            success: false,
                            errors: ["ì„œë²„ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤"]
                        };
                    }
                }
            }
        }
        
        // 3ï¸âƒ£ ì‹¤ë¬´ ì‹œë‚˜ë¦¬ì˜¤ ì‹œë®¬ë ˆì´ì…˜
        async function demonstrateSpringIntegration() {
            console.log("=== Spring Boot ì—°ë™ ì‹œë®¬ë ˆì´ì…˜ ===");
            
            const apiService = new SpringApiService();
            const formHandler = new UserFormHandler(apiService);
            
            // ğŸ”„ ì‹¤ì œë¡œëŠ” ì„œë²„ê°€ ì—†ìœ¼ë¯€ë¡œ Mock API ì‚¬ìš©
            // í•™ìŠµìš©ìœ¼ë¡œ JSONPlaceholder ì‚¬ìš©
            const mockApi = new class {
                async createUser(userData) {
                    // ì‹¤ì œ Spring Boot ì‘ë‹µ í˜•ì‹ ì‹œë®¬ë ˆì´ì…˜
                    return {
                        id: Date.now(),
                        ...userData,
                        createdAt: new Date().toISOString(),
                        updatedAt: new Date().toISOString()
                    };
                }
                
                async getUsers() {
                    const response = await fetch('https://jsonplaceholder.typicode.com/users');
                    return response.json();
                }
            };
            
            try {
                // ì‚¬ìš©ì ëª©ë¡ ì¡°íšŒ
                const users = await mockApi.getUsers();
                console.log(`ğŸ“‹ ì´ ${users.length}ëª…ì˜ ì‚¬ìš©ì ì¡°íšŒë¨`);
                
                // ìƒˆ ì‚¬ìš©ì ë“±ë¡ í…ŒìŠ¤íŠ¸
                const newUserData = {
                    name: "ê¹€ìŠ¤í”„ë§",
                    email: "spring@example.com",
                    age: 28,
                    department: "ë°±ì—”ë“œíŒ€"
                };
                
                const registrationResult = await formHandler.handleUserRegistration(newUserData);
                
                if (registrationResult.success) {
                    console.log("âœ… ì‚¬ìš©ì ë“±ë¡ ì„±ê³µ:", registrationResult.data);
                } else {
                    console.log("âŒ ì‚¬ìš©ì ë“±ë¡ ì‹¤íŒ¨:", registrationResult.errors);
                }
                
                // ìœ íš¨ì„± ê²€ì‚¬ ì‹¤íŒ¨ ì¼€ì´ìŠ¤ í…ŒìŠ¤íŠ¸
                const invalidUserData = {
                    name: "",           // ë¹ˆ ì´ë¦„
                    email: "invalid",   // ì˜ëª»ëœ ì´ë©”ì¼
                    age: -5            // ì˜ëª»ëœ ë‚˜ì´
                };
                
                const invalidResult = await formHandler.handleUserRegistration(invalidUserData);
                console.log("âŒ ìœ íš¨ì„± ê²€ì‚¬ ì‹¤íŒ¨ ì˜ˆì œ:", invalidResult.errors);
                
            } catch (error) {
                console.log("ğŸš¨ ì „ì²´ í”„ë¡œì„¸ìŠ¤ ì‹¤íŒ¨:", error.message);
            }
        }
        
        // 4ï¸âƒ£ ì‹¤ë¬´ íŒê³¼ Best Practice
        console.log("=== ğŸ’¡ Spring Boot ì—°ë™ ì‹¤ë¬´ íŒ ===");
        console.log("1. API ê¸°ë³¸ URLì€ í™˜ê²½ë³„ë¡œ ë¶„ë¦¬ (dev, prod)");
        console.log("2. ê³µí†µ ì—ëŸ¬ ì²˜ë¦¬ë¡œ ì¼ê´€ì„± ìˆëŠ” ì‚¬ìš©ì ê²½í—˜");
        console.log("3. Loading ìƒíƒœ ê´€ë¦¬ë¡œ ì‚¬ìš©ìì—ê²Œ í”¼ë“œë°± ì œê³µ");
        console.log("4. JWT í† í° ë§Œë£Œ ì‹œ ìë™ ê°±ì‹  ë¡œì§ êµ¬í˜„");
        console.log("5. API ì‘ë‹µ ìºì‹±ìœ¼ë¡œ ì„±ëŠ¥ ìµœì í™”");
        console.log("6. TypeScript ì‚¬ìš© ì‹œ DTO ì¸í„°í˜ì´ìŠ¤ ì •ì˜");
        
        // 5ï¸âƒ£ ì—ëŸ¬ ì²˜ë¦¬ íŒ¨í„´
        class ErrorHandler {
            static handle(error) {
                console.log("ğŸ”§ ì—ëŸ¬ ì²˜ë¦¬:", error);
                
                switch (error.status) {
                    case 400:
                        return "ì…ë ¥ ë°ì´í„°ë¥¼ í™•ì¸í•´ì£¼ì„¸ìš”";
                    case 401:
                        return "ë¡œê·¸ì¸ì´ í•„ìš”í•©ë‹ˆë‹¤";
                    case 403:
                        return "ê¶Œí•œì´ ì—†ìŠµë‹ˆë‹¤";
                    case 404:
                        return "ìš”ì²­í•œ ë°ì´í„°ë¥¼ ì°¾ì„ ìˆ˜ ì—†ìŠµë‹ˆë‹¤";
                    case 409:
                        return "ì´ë¯¸ ì¡´ì¬í•˜ëŠ” ë°ì´í„°ì…ë‹ˆë‹¤";
                    case 500:
                        return "ì„œë²„ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤";
                    default:
                        return "ë„¤íŠ¸ì›Œí¬ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤";
                }
            }
        }
        
        // 6ï¸âƒ£ ë¡œë”© ìƒíƒœ ê´€ë¦¬
        class LoadingManager {
            constructor() {
                this.loadingStates = new Map();
            }
            
            setLoading(key, isLoading) {
                this.loadingStates.set(key, isLoading);
                console.log(`ğŸ”„ ${key} ë¡œë”© ìƒíƒœ:`, isLoading ? "ì‹œì‘" : "ì™„ë£Œ");
            }
            
            isLoading(key) {
                return this.loadingStates.get(key) || false;
            }
            
            async withLoading(key, asyncFunction) {
                try {
                    this.setLoading(key, true);
                    const result = await asyncFunction();
                    return result;
                } finally {
                    this.setLoading(key, false);
                }
            }
        }
        
        // 7ï¸âƒ£ ì¢…í•© ì‹¤ë¬´ ì˜ˆì œ
        async function comprehensiveExample() {
            const loadingManager = new LoadingManager();
            
            // ì‚¬ìš©ì ëª©ë¡ ì¡°íšŒ with ë¡œë”© ê´€ë¦¬
            const users = await loadingManager.withLoading('userList', async () => {
                const response = await fetch('https://jsonplaceholder.typicode.com/users');
                if (!response.ok) throw new Error('ì‚¬ìš©ì ëª©ë¡ ì¡°íšŒ ì‹¤íŒ¨');
                return response.json();
            });
            
            console.log("ğŸ“Š ì¢…í•© ì˜ˆì œ - ì‚¬ìš©ì ëª©ë¡:", users.slice(0, 3));
            
            // ì—ëŸ¬ ì²˜ë¦¬ ì˜ˆì œ
            try {
                await fetch('https://invalid-url-that-will-fail.com/api');
            } catch (error) {
                const userMessage = ErrorHandler.handle(error);
                console.log("ğŸ¯ ì‚¬ìš©ì ì¹œí™”ì  ì—ëŸ¬ ë©”ì‹œì§€:", userMessage);
            }
        }
        
        // ëª¨ë“  ì˜ˆì œ ì‹¤í–‰
        demonstrateSpringIntegration();
        comprehensiveExample();
        
        alert("ì½˜ì†”ì—ì„œ Spring Boot API ì—°ë™ íŒ¨í„´ì„ í™•ì¸í•˜ì„¸ìš”!");
    }
</script>
</body>
</html>