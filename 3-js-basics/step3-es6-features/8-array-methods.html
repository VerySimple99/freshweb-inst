/*
ğŸ¯ 5ê°€ì§€ í•µì‹¬ ì„¹ì…˜
1ï¸âƒ£ map - ë³€í™˜ì˜ ë§ˆë²•ì‚¬

ë°°ì—´ì˜ ëª¨ë“  ìš”ì†Œë¥¼ ë³€í™˜í•˜ì—¬ ìƒˆ ë°°ì—´ ìƒì„±
ì„¸ê¸ˆ ê³„ì‚°, ë°ì´í„° í¬ë§·íŒ…, UIìš© ë°ì´í„° ë³€í™˜
React ì»´í¬ë„ŒíŠ¸ ë Œë”ë§ì˜ í•µì‹¬ íŒ¨í„´

2ï¸âƒ£ filter - ì¡°ê±´ë¶€ ì„ ë³„

ì¡°ê±´ì— ë§ëŠ” ìš”ì†Œë§Œ ê³¨ë¼ì„œ ìƒˆ ë°°ì—´ ìƒì„±
ê²€ìƒ‰, ì¹´í…Œê³ ë¦¬ í•„í„°ë§, ë™ì  ì¡°ê±´ ì²˜ë¦¬
í˜ì´ì§€ë„¤ì´ì…˜ê³¼ ì¡°í•©í•œ ì‹¤ë¬´ íŒ¨í„´

3ï¸âƒ£ reduce - ì§‘ê³„ì˜ ì™•

ë°°ì—´ì„ í•˜ë‚˜ì˜ ê°’ìœ¼ë¡œ ì¶•ì•½ (í•©ê³„, í‰ê· , ê·¸ë£¹í™”)
ì¥ë°”êµ¬ë‹ˆ ê³„ì‚°, í†µê³„ ìƒì„±, ê°ì²´ ë³€í™˜
ê°€ì¥ ê°•ë ¥í•˜ì§€ë§Œ ì–´ë ¤ìš´ ë©”ì„œë“œì˜ í•µì‹¬ íŒ¨í„´ë“¤

4ï¸âƒ£ find/some/every - ê²€ìƒ‰ê³¼ ê²€ì¦

find: ì¡°ê±´ì— ë§ëŠ” ì²« ë²ˆì§¸ ìš”ì†Œ ì°¾ê¸°
some: í•˜ë‚˜ë¼ë„ ì¡°ê±´ì— ë§ëŠ”ì§€ í™•ì¸ (OR)
every: ëª¨ë‘ ì¡°ê±´ì— ë§ëŠ”ì§€ í™•ì¸ (AND)
ë°ì´í„° ê²€ì¦ê³¼ ì¡°ê±´ë¶€ ë¡œì§ì˜ í•µì‹¬

5ï¸âƒ£ Spring ë°ì´í„° ì²˜ë¦¬ ì‹¤ë¬´

Spring Page<T> ì‘ë‹µ ì²˜ë¦¬
ê²€ìƒ‰/í•„í„°ë§ íŒŒë¼ë¯¸í„° ì²˜ë¦¬
í†µê³„ ëŒ€ì‹œë³´ë“œ ë°ì´í„° ìƒì„±
ì£¼ë¬¸ ì²˜ë¦¬ ì‹œìŠ¤í…œ
ì‹¤ì‹œê°„ ì¬ê³  ì—…ë°ì´íŠ¸
ì¶”ì²œ ì‹œìŠ¤í…œ ë°ì´í„° ê°€ê³µ


ğŸ’¡ Spring í•™ìŠµì— íŠ¹íˆ ìœ ìš©í•œ ì´ìœ :
ğŸŒ± ì‹¤ë¬´ ì§ê²°:

Spring Data JPAì˜ Page ì‘ë‹µ ì²˜ë¦¬
@RequestParam ê²€ìƒ‰ ì¡°ê±´ ì²˜ë¦¬
@Transactional ì£¼ë¬¸ ë¡œì§ì˜ ë°ì´í„° ê°€ê³µ

ğŸ“Š ë°ì´í„° ì²˜ë¦¬:

Controllerì—ì„œ ë°›ì€ JSONì„ UIì— ë§ê²Œ ë³€í™˜
ë³µì¡í•œ ë¹„ì¦ˆë‹ˆìŠ¤ ë¡œì§ì„ í•¨ìˆ˜í˜• ìŠ¤íƒ€ì¼ë¡œ êµ¬í˜„
ëŒ€ì‹œë³´ë“œì™€ í†µê³„ í™”ë©´ì˜ ë°ì´í„° ê°€ê³µ

ğŸ”— ë©”ì„œë“œ ì²´ì´ë‹:

filter().map().reduce() ì¡°í•©ìœ¼ë¡œ ë³µì¡í•œ ë°ì´í„° íŒŒì´í”„ë¼ì¸ êµ¬ì¶•
ë¶ˆë³€ì„±ì„ ìœ ì§€í•˜ë©° ì•ˆì „í•œ ë°ì´í„° ì²˜ë¦¬
*/

<!DOCTYPE html>
<html>
<head>
<meta charset="UTF-8">
<title>ES6+ ë°°ì—´ ë©”ì„œë“œ ì™„ì „ ì •ë³µ</title>
</head>
<body>
ES6+ ë°°ì—´ ë©”ì„œë“œ: map, filter, reduce, find ë“±ìœ¼ë¡œ í•¨ìˆ˜í˜• í”„ë¡œê·¸ë˜ë°ì˜ í•µì‹¬
<br><br>

<button onclick="mapMethod()">map - ë³€í™˜</button>
<button onclick="filterMethod()">filter - í•„í„°ë§</button>
<button onclick="reduceMethod()">reduce - ì§‘ê³„</button>
<button onclick="findMethods()">find/some/every - ê²€ìƒ‰</button>
<button onclick="springDataExample()">Spring ë°ì´í„° ì²˜ë¦¬</button>

<script>
    // ğŸ¯ í•™ìŠµ ëª©í‘œ: ë°°ì—´ ë©”ì„œë“œë¡œ í•¨ìˆ˜í˜• í”„ë¡œê·¸ë˜ë° ë§ˆìŠ¤í„°í•˜ê¸°
    // ğŸ’¡ í•µì‹¬ ê°œë…:
    // - map: ë°°ì—´ì˜ ëª¨ë“  ìš”ì†Œë¥¼ ë³€í™˜í•˜ì—¬ ìƒˆ ë°°ì—´ ìƒì„± (1:1 ëŒ€ì‘)
    // - filter: ì¡°ê±´ì— ë§ëŠ” ìš”ì†Œë§Œ ê³¨ë¼ì„œ ìƒˆ ë°°ì—´ ìƒì„±
    // - reduce: ë°°ì—´ì„ í•˜ë‚˜ì˜ ê°’ìœ¼ë¡œ ì§‘ê³„ (í•©ê³„, í‰ê· , ê°ì²´ ë³€í™˜ ë“±)
    // - find: ì¡°ê±´ì— ë§ëŠ” ì²« ë²ˆì§¸ ìš”ì†Œ ì°¾ê¸°
    // - Springì—ì„œ ë°›ì€ ë°ì´í„°ë¥¼ ê°€ê³µí•  ë•Œ í•„ìˆ˜ ê¸°ìˆ 

    // ğŸ“š ì‹¤ìŠµìš© ë°ì´í„° - ì‹¤ì œ Spring Controllerì—ì„œ ë°›ì„ ë²•í•œ ë°ì´í„°
    const products = [
        { id: 1, name: "ë…¸íŠ¸ë¶", price: 1200000, category: "ì „ìì œí’ˆ", inStock: true, rating: 4.5 },
        { id: 2, name: "ë§ˆìš°ìŠ¤", price: 35000, category: "ì „ìì œí’ˆ", inStock: false, rating: 4.2 },
        { id: 3, name: "í‚¤ë³´ë“œ", price: 89000, category: "ì „ìì œí’ˆ", inStock: true, rating: 4.7 },
        { id: 4, name: "ëª¨ë‹ˆí„°", price: 350000, category: "ì „ìì œí’ˆ", inStock: true, rating: 4.3 },
        { id: 5, name: "ì±…ìƒ", price: 180000, category: "ê°€êµ¬", inStock: true, rating: 4.1 }
    ];

    function mapMethod() {
        console.log("=== map: ë°°ì—´ ë³€í™˜ì˜ ë§ˆë²•ì‚¬ ===");
        
        // ğŸ” mapì˜ í•µì‹¬ ê°œë…
        // ì›ë³¸ ë°°ì—´ì˜ ê° ìš”ì†Œë¥¼ ë³€í™˜í•´ì„œ ìƒˆë¡œìš´ ë°°ì—´ì„ ìƒì„±
        // ì›ë³¸ ë°°ì—´ì€ ì ˆëŒ€ ë³€ê²½í•˜ì§€ ì•ŠìŒ (ë¶ˆë³€ì„± ì›ì¹™)
        // ì…ë ¥ ë°°ì—´ê³¼ ì¶œë ¥ ë°°ì—´ì˜ ê¸¸ì´ê°€ í•­ìƒ ê°™ìŒ (1:1 ëŒ€ì‘)
        // Reactì—ì„œ ì»´í¬ë„ŒíŠ¸ ë¦¬ìŠ¤íŠ¸ ë Œë”ë§í•  ë•Œ í•„ìˆ˜

        // 1ï¸âƒ£ ê¸°ë³¸ ì‚¬ìš©ë²•: ê°€ê²©ì— ì„¸ê¸ˆ 10% ì¶”ê°€
        const withTax = products.map(product => {
            // ê° ìƒí’ˆ ê°ì²´ë¥¼ ë°›ì•„ì„œ ì„¸ê¸ˆì´ ì¶”ê°€ëœ ìƒˆ ê°ì²´ ë°˜í™˜
            // ì „ê°œ ì—°ì‚°ìë¡œ ê¸°ì¡´ ì†ì„±ì„ ëª¨ë‘ ë³µì‚¬í•˜ê³  ìƒˆ ì†ì„± ì¶”ê°€
            return {
                ...product,                          // ê¸°ì¡´ ëª¨ë“  ì†ì„± ë³µì‚¬
                priceWithTax: Math.round(product.price * 1.1), // ì„¸ê¸ˆ í¬í•¨ ê°€ê²© ê³„ì‚°
                formattedPrice: product.price.toLocaleString() + "ì›" // ì²œ ë‹¨ìœ„ êµ¬ë¶„
            };
        });
        
        console.log("ì„¸ê¸ˆ í¬í•¨ ìƒí’ˆ:", withTax);

        // 2ï¸âƒ£ íŠ¹ì • ì†ì„±ë§Œ ì¶”ì¶œ: ìƒí’ˆëª… ë¦¬ìŠ¤íŠ¸ ë§Œë“¤ê¸°
        // API ì‘ë‹µì—ì„œ í•„ìš”í•œ ë°ì´í„°ë§Œ ë½‘ì•„ë‚¼ ë•Œ ë§¤ìš° ìœ ìš©
        const productNames = products.map(product => product.name);
        console.log("ìƒí’ˆëª… ëª©ë¡:", productNames); // ["ë…¸íŠ¸ë¶", "ë§ˆìš°ìŠ¤", ...]

        // í™”ì‚´í‘œ í•¨ìˆ˜ ë‹¨ì¶• ë¬¸ë²• (ì¤‘ê´„í˜¸ ìƒëµ ì‹œ ìë™ return)
        const prices = products.map(p => p.price);
        const categories = products.map(p => p.category);
        console.log("ê°€ê²© ëª©ë¡:", prices);
        console.log("ì¹´í…Œê³ ë¦¬ ëª©ë¡:", categories);

        // 3ï¸âƒ£ ë³µì¡í•œ ë³€í™˜: ë“±ê¸‰ë³„ ë¼ë²¨ ì¶”ê°€
        const withGradeLabels = products.map(product => {
            // í‰ì ì— ë”°ë¼ ë“±ê¸‰ ë¼ë²¨ ê²°ì •
            let gradeLabel;
            if (product.rating >= 4.5) gradeLabel = "â­ ìµœìš°ìˆ˜";
            else if (product.rating >= 4.0) gradeLabel = "ğŸ‘ ìš°ìˆ˜";
            else gradeLabel = "ğŸ“ ë³´í†µ";

            return {
                id: product.id,
                name: product.name,
                price: product.price,
                gradeLabel,                    // ìƒˆë¡œ ê³„ì‚°ëœ ë“±ê¸‰ ë¼ë²¨
                displayName: `${gradeLabel} ${product.name}`, // í‘œì‹œìš© ì´ë¦„
                isRecommended: product.rating >= 4.5 && product.inStock // ì¶”ì²œ ì—¬ë¶€
            };
        });

        console.log("ë“±ê¸‰ ë¼ë²¨ì´ ì¶”ê°€ëœ ìƒí’ˆ:", withGradeLabels);

        // 4ï¸âƒ£ ì¸ë±ìŠ¤ í™œìš©: ìˆœìœ„ ì •ë³´ ì¶”ê°€
        // mapì˜ ë‘ ë²ˆì§¸ ë§¤ê°œë³€ìˆ˜ëŠ” í˜„ì¬ ì¸ë±ìŠ¤
        const rankedProducts = products
            .sort((a, b) => b.rating - a.rating) // í‰ì  ë†’ì€ ìˆœìœ¼ë¡œ ì •ë ¬
            .map((product, index) => ({
                ...product,
                rank: index + 1,                    // ìˆœìœ„ (1ë¶€í„° ì‹œì‘)
                medal: index === 0 ? "ğŸ¥‡" : index === 1 ? "ğŸ¥ˆ" : index === 2 ? "ğŸ¥‰" : ""
            }));

        console.log("ìˆœìœ„ê°€ ë§¤ê²¨ì§„ ìƒí’ˆ:", rankedProducts);

        // ğŸ’¼ ì‹¤ë¬´ í™œìš©: API ì‘ë‹µ ë°ì´í„°ë¥¼ UIì— ë§ê²Œ ë³€í™˜
        // Spring Controllerì—ì„œ ë°›ì€ ë°ì´í„°ë¥¼ í™”ë©´ í‘œì‹œìš©ìœ¼ë¡œ ê°€ê³µ
        const displayData = products.map(product => ({
            // UIì—ì„œ í•„ìš”í•œ í˜•íƒœë¡œ ë°ì´í„° ì¬êµ¬ì„±
            key: `product-${product.id}`,          // React key propìš©
            title: product.name.toUpperCase(),     // ì œëª©ì€ ëŒ€ë¬¸ìë¡œ
            subtitle: `${product.category} | ${product.rating}â­`, // ë¶€ì œëª©
            price: {
                original: product.price,
                formatted: `${product.price.toLocaleString()}ì›`,
                isExpensive: product.price >= 100000
            },
            status: {
                available: product.inStock,
                label: product.inStock ? "êµ¬ë§¤ ê°€ëŠ¥" : "í’ˆì ˆ",
                color: product.inStock ? "green" : "red"
            },
            badges: [
                product.rating >= 4.5 && "ì¸ê¸°",
                product.price >= 500000 && "í”„ë¦¬ë¯¸ì—„",
                product.inStock && "ì¬ê³  ìˆìŒ"
            ].filter(Boolean) // falsy ê°’ë“¤ ì œê±°
        }));

        console.log("UIìš© í‘œì‹œ ë°ì´í„°:", displayData);

        alert("ì½˜ì†”ì—ì„œ mapìœ¼ë¡œ ë³€í™˜ëœ ë‹¤ì–‘í•œ ë°ì´í„°ë¥¼ í™•ì¸í•˜ì„¸ìš”!");
    }

    function filterMethod() {
        console.log("=== filter: ì¡°ê±´ì— ë§ëŠ” ë°ì´í„°ë§Œ ê³¨ë¼ë‚´ê¸° ===");

        // ğŸ” filterì˜ í•µì‹¬ ê°œë…
        // ë°°ì—´ì—ì„œ íŠ¹ì • ì¡°ê±´ì„ ë§Œì¡±í•˜ëŠ” ìš”ì†Œë“¤ë§Œ ê³¨ë¼ì„œ ìƒˆ ë°°ì—´ ìƒì„±
        // ì½œë°± í•¨ìˆ˜ê°€ trueë¥¼ ë°˜í™˜í•˜ëŠ” ìš”ì†Œë§Œ ê²°ê³¼ ë°°ì—´ì— í¬í•¨
        // ê²€ìƒ‰, ì¹´í…Œê³ ë¦¬ í•„í„°ë§, ì¡°ê±´ë¶€ í‘œì‹œì—ì„œ í•„ìˆ˜
        // ì›ë³¸ ë°°ì—´ì€ ë³€ê²½ë˜ì§€ ì•ŠìŒ

        // 1ï¸âƒ£ ê¸°ë³¸ í•„í„°ë§: ì¬ê³  ìˆëŠ” ìƒí’ˆë§Œ
        const inStockProducts = products.filter(product => product.inStock);
        console.log("ì¬ê³  ìˆëŠ” ìƒí’ˆ:", inStockProducts);

        // 2ï¸âƒ£ ê°€ê²© ë²”ìœ„ í•„í„°ë§: 10ë§Œì› ì´ìƒ ê³ ê°€ ìƒí’ˆ
        const expensiveProducts = products.filter(product => product.price >= 100000);
        console.log("ê³ ê°€ ìƒí’ˆ (10ë§Œì› ì´ìƒ):", expensiveProducts);

        // 3ï¸âƒ£ ë³µí•© ì¡°ê±´: ì¬ê³  ìˆìœ¼ë©´ì„œ í‰ì  4.0 ì´ìƒì¸ ì¶”ì²œ ìƒí’ˆ
        const recommendedProducts = products.filter(product => {
            return product.inStock &&           // ì¬ê³  ìˆìŒ
                   product.rating >= 4.0 &&     // í‰ì  4.0 ì´ìƒ
                   product.price <= 500000;     // 50ë§Œì› ì´í•˜ (ì ‘ê·¼ì„±)
        });
        console.log("ì¶”ì²œ ìƒí’ˆ:", recommendedProducts);

        // 4ï¸âƒ£ ì¹´í…Œê³ ë¦¬ë³„ í•„í„°ë§
        const electronics = products.filter(p => p.category === "ì „ìì œí’ˆ");
        const furniture = products.filter(p => p.category === "ê°€êµ¬");
        console.log("ì „ìì œí’ˆ:", electronics);
        console.log("ê°€êµ¬:", furniture);

        // 5ï¸âƒ£ ë™ì  í•„í„°ë§ í•¨ìˆ˜: ì‹¤ë¬´ì—ì„œ ìì£¼ ì‚¬ìš©í•˜ëŠ” íŒ¨í„´
        // ì‚¬ìš©ìê°€ ì„ íƒí•œ ì¡°ê±´ì— ë”°ë¼ ë™ì ìœ¼ë¡œ í•„í„°ë§
        function createProductFilter(conditions) {
            return function(product) {
                // ëª¨ë“  ì¡°ê±´ì„ ë§Œì¡±í•˜ëŠ”ì§€ ê²€ì‚¬
                if (conditions.minPrice && product.price < conditions.minPrice) return false;
                if (conditions.maxPrice && product.price > conditions.maxPrice) return false;
                if (conditions.category && product.category !== conditions.category) return false;
                if (conditions.minRating && product.rating < conditions.minRating) return false;
                if (conditions.inStockOnly && !product.inStock) return false;
                
                return true; // ëª¨ë“  ì¡°ê±´ í†µê³¼
            };
        }

        // ë‹¤ì–‘í•œ ì¡°ê±´ìœ¼ë¡œ í•„í„°ë§ í…ŒìŠ¤íŠ¸
        const filter1 = createProductFilter({ 
            minPrice: 50000, 
            maxPrice: 200000, 
            inStockOnly: true 
        });
        const midRangeProducts = products.filter(filter1);
        console.log("ì¤‘ê°€ ì¬ê³  ìƒí’ˆ (5-20ë§Œì›):", midRangeProducts);

        const filter2 = createProductFilter({ 
            category: "ì „ìì œí’ˆ", 
            minRating: 4.5 
        });
        const premiumElectronics = products.filter(filter2);
        console.log("í”„ë¦¬ë¯¸ì—„ ì „ìì œí’ˆ:", premiumElectronics);

        // 6ï¸âƒ£ ë¬¸ìì—´ ê²€ìƒ‰ í•„í„°ë§: ìƒí’ˆëª… ê²€ìƒ‰
        function searchProducts(searchTerm) {
            const term = searchTerm.toLowerCase();
            return products.filter(product => 
                product.name.toLowerCase().includes(term) ||
                product.category.toLowerCase().includes(term)
            );
        }

        const laptopResults = searchProducts("ë¶");
        const electronicResults = searchProducts("ì „ì");
        console.log("'ë¶' ê²€ìƒ‰ ê²°ê³¼:", laptopResults);
        console.log("'ì „ì' ê²€ìƒ‰ ê²°ê³¼:", electronicResults);

        // ğŸ’¼ ì‹¤ë¬´ í™œìš©: í˜ì´ì§€ë„¤ì´ì…˜ê³¼ ì¡°í•©
        function paginateProducts(products, page = 1, itemsPerPage = 2) {
            const startIndex = (page - 1) * itemsPerPage;
            const endIndex = startIndex + itemsPerPage;
            
            return {
                data: products.slice(startIndex, endIndex),
                pagination: {
                    currentPage: page,
                    totalPages: Math.ceil(products.length / itemsPerPage),
                    totalItems: products.length,
                    hasNextPage: endIndex < products.length,
                    hasPrevPage: page > 1
                }
            };
        }

        // ì¬ê³  ìˆëŠ” ìƒí’ˆì„ í˜ì´ì§€ë³„ë¡œ ì¡°íšŒ
        const page1 = paginateProducts(inStockProducts, 1, 2);
        const page2 = paginateProducts(inStockProducts, 2, 2);
        console.log("ì¬ê³  ìƒí’ˆ 1í˜ì´ì§€:", page1);
        console.log("ì¬ê³  ìƒí’ˆ 2í˜ì´ì§€:", page2);

        // ğŸ”— filterì™€ map ì¡°í•©: í•„í„°ë§ í›„ ë³€í™˜
        const discountedInStock = products
            .filter(p => p.inStock)                    // 1ë‹¨ê³„: ì¬ê³  ìˆëŠ” ê²ƒë§Œ
            .map(p => ({                               // 2ë‹¨ê³„: í• ì¸ê°€ ê³„ì‚°
                ...p,
                originalPrice: p.price,
                discountPrice: Math.round(p.price * 0.9), // 10% í• ì¸
                savings: Math.round(p.price * 0.1)
            }));

        console.log("í• ì¸ê°€ê°€ ì ìš©ëœ ì¬ê³  ìƒí’ˆ:", discountedInStock);

        alert("ì½˜ì†”ì—ì„œ ë‹¤ì–‘í•œ í•„í„°ë§ ê²°ê³¼ë¥¼ í™•ì¸í•˜ì„¸ìš”!");
    }

    function reduceMethod() {
        console.log("=== reduce: ë°°ì—´ì„ í•˜ë‚˜ì˜ ê°’ìœ¼ë¡œ ì§‘ê³„í•˜ê¸° ===");

        // ğŸ” reduceì˜ í•µì‹¬ ê°œë…
        // ë°°ì—´ì˜ ëª¨ë“  ìš”ì†Œë¥¼ ìˆœíšŒí•˜ë©´ì„œ í•˜ë‚˜ì˜ ê°’ìœ¼ë¡œ ëˆ„ì 
        // accumulator(ëˆ„ì ê°’)ì™€ current(í˜„ì¬ê°’)ì„ ë°›ì•„ì„œ ìƒˆ ëˆ„ì ê°’ ë°˜í™˜
        // í•©ê³„, í‰ê· , ìµœëŒ€/ìµœì†Œê°’, ê°ì²´ ë³€í™˜, ê·¸ë£¹í™” ë“± ë§ŒëŠ¥ ë©”ì„œë“œ
        // í•¨ìˆ˜í˜• í”„ë¡œê·¸ë˜ë°ì˜ í•µì‹¬ì´ì ê°€ì¥ ê°•ë ¥í•œ ë°°ì—´ ë©”ì„œë“œ

        // 1ï¸âƒ£ ê¸°ë³¸ ì§‘ê³„: ì´ ê°€ê²© ê³„ì‚°
        const totalPrice = products.reduce((sum, product) => {
            console.log(`í˜„ì¬ í•©ê³„: ${sum}, ìƒí’ˆ ê°€ê²©: ${product.price}`);
            return sum + product.price; // ëˆ„ì  í•©ê³„ì— í˜„ì¬ ìƒí’ˆ ê°€ê²© ì¶”ê°€
        }, 0); // ì´ˆê¸°ê°’ 0ë¶€í„° ì‹œì‘

        console.log("ì´ ìƒí’ˆ ê°€ê²©:", totalPrice.toLocaleString() + "ì›");

        // 2ï¸âƒ£ í‰ê·  ê³„ì‚°: í‰ê·  ê°€ê²©ê³¼ í‰ê·  í‰ì 
        const averagePrice = products.reduce((sum, product) => sum + product.price, 0) / products.length;
        const averageRating = products.reduce((sum, product) => sum + product.rating, 0) / products.length;

        console.log("í‰ê·  ê°€ê²©:", Math.round(averagePrice).toLocaleString() + "ì›");
        console.log("í‰ê·  í‰ì :", averageRating.toFixed(1) + "ì ");

        // 3ï¸âƒ£ ìµœëŒ€/ìµœì†Œê°’ ì°¾ê¸°
        const mostExpensive = products.reduce((max, product) => 
            product.price > max.price ? product : max
        );

        const highestRated = products.reduce((best, product) => 
            product.rating > best.rating ? product : best
        );

        console.log("ê°€ì¥ ë¹„ì‹¼ ìƒí’ˆ:", mostExpensive.name, mostExpensive.price.toLocaleString() + "ì›");
        console.log("í‰ì ì´ ê°€ì¥ ë†’ì€ ìƒí’ˆ:", highestRated.name, highestRated.rating + "ì ");

        // 4ï¸âƒ£ ê°ì²´ë¡œ ë³€í™˜: IDë¥¼ í‚¤ë¡œ í•˜ëŠ” ê°ì²´ ë§Œë“¤ê¸°
        // Springì—ì„œ ë°›ì€ ë°°ì—´ ë°ì´í„°ë¥¼ ë¹ ë¥¸ ì¡°íšŒë¥¼ ìœ„í•´ ê°ì²´ë¡œ ë³€í™˜
        const productMap = products.reduce((map, product) => {
            map[product.id] = product; // IDë¥¼ í‚¤ë¡œ í•´ì„œ ìƒí’ˆ ì €ì¥
            return map;
        }, {});

        console.log("ID ë§µí•‘ ê°ì²´:", productMap);
        console.log("ID 3ë²ˆ ìƒí’ˆ ë¹ ë¥¸ ì¡°íšŒ:", productMap[3]);

        // 5ï¸âƒ£ ê·¸ë£¹í™”: ì¹´í…Œê³ ë¦¬ë³„ë¡œ ìƒí’ˆ ë¶„ë¥˜
        // ì‹¤ë¬´ì—ì„œ ë§¤ìš° ìì£¼ ì‚¬ìš©í•˜ëŠ” íŒ¨í„´ (ì°¨íŠ¸ ë°ì´í„°, í†µê³„ ë“±)
        const groupedByCategory = products.reduce((groups, product) => {
            const category = product.category;
            
            // í•´ë‹¹ ì¹´í…Œê³ ë¦¬ ê·¸ë£¹ì´ ì—†ìœ¼ë©´ ìƒì„±
            if (!groups[category]) {
                groups[category] = [];
            }
            
            groups[category].push(product);
            return groups;
        }, {});

        console.log("ì¹´í…Œê³ ë¦¬ë³„ ê·¸ë£¹:", groupedByCategory);

        // 6ï¸âƒ£ ë³µì¡í•œ í†µê³„: ì¹´í…Œê³ ë¦¬ë³„ ìƒì„¸ ë¶„ì„
        const categoryStats = products.reduce((stats, product) => {
            const category = product.category;
            
            // ì¹´í…Œê³ ë¦¬ í†µê³„ ì´ˆê¸°í™”
            if (!stats[category]) {
                stats[category] = {
                    count: 0,
                    totalPrice: 0,
                    totalRating: 0,
                    inStockCount: 0,
                    products: []
                };
            }
            
            const catStats = stats[category];
            catStats.count++;
            catStats.totalPrice += product.price;
            catStats.totalRating += product.rating;
            if (product.inStock) catStats.inStockCount++;
            catStats.products.push(product.name);
            
            return stats;
        }, {});

        // í†µê³„ ì™„ì„±: í‰ê· ê°’ ê³„ì‚°
        Object.keys(categoryStats).forEach(category => {
            const stats = categoryStats[category];
            stats.averagePrice = Math.round(stats.totalPrice / stats.count);
            stats.averageRating = (stats.totalRating / stats.count).toFixed(1);
            stats.stockRate = ((stats.inStockCount / stats.count) * 100).toFixed(1) + "%";
        });

        console.log("ì¹´í…Œê³ ë¦¬ë³„ ìƒì„¸ í†µê³„:", categoryStats);

        // 7ï¸âƒ£ ì‹¤ë¬´ íŒ¨í„´: ì¥ë°”êµ¬ë‹ˆ ê³„ì‚°
        // ì‚¬ìš©ìê°€ ì„ íƒí•œ ìƒí’ˆë“¤ì˜ ì´ ê¸ˆì•¡, í• ì¸, ë°°ì†¡ë¹„ ê³„ì‚°
        const cartItems = [
            { productId: 1, quantity: 2 }, // ë…¸íŠ¸ë¶ 2ê°œ
            { productId: 3, quantity: 1 }, // í‚¤ë³´ë“œ 1ê°œ
            { productId: 4, quantity: 1 }  // ëª¨ë‹ˆí„° 1ê°œ
        ];

        const cartSummary = cartItems.reduce((summary, cartItem) => {
            // ìƒí’ˆ ì •ë³´ ì°¾ê¸°
            const product = products.find(p => p.id === cartItem.productId);
            if (!product) return summary; // ìƒí’ˆì´ ì—†ìœ¼ë©´ ê±´ë„ˆë›°ê¸°

            const itemTotal = product.price * cartItem.quantity;
            
            summary.items.push({
                name: product.name,
                price: product.price,
                quantity: cartItem.quantity,
                total: itemTotal
            });
            
            summary.subtotal += itemTotal;
            summary.totalQuantity += cartItem.quantity;
            
            return summary;
        }, {
            items: [],
            subtotal: 0,
            totalQuantity: 0
        });

        // ìµœì¢… ê³„ì‚°: í• ì¸ê³¼ ë°°ì†¡ë¹„
        cartSummary.discount = cartSummary.subtotal >= 500000 ? cartSummary.subtotal * 0.05 : 0; // 50ë§Œì› ì´ìƒ 5% í• ì¸
        cartSummary.shippingFee = cartSummary.subtotal >= 300000 ? 0 : 3000; // 30ë§Œì› ì´ìƒ ë¬´ë£Œë°°ì†¡
        cartSummary.total = cartSummary.subtotal - cartSummary.discount + cartSummary.shippingFee;

        console.log("ì¥ë°”êµ¬ë‹ˆ ìš”ì•½:", cartSummary);

        // 8ï¸âƒ£ ì‹¤ë¬´ í™œìš©: ë°°ì—´ì„ ì›í•˜ëŠ” í˜•íƒœë¡œ ë³€í™˜
        // Springì—ì„œ ë°›ì€ ë°ì´í„°ë¥¼ ì°¨íŠ¸ ë¼ì´ë¸ŒëŸ¬ë¦¬ìš© ë°ì´í„°ë¡œ ë³€í™˜
        const chartData = products.reduce((data, product) => {
            data.labels.push(product.name);
            data.prices.push(product.price);
            data.ratings.push(product.rating);
            return data;
        }, {
            labels: [],
            prices: [],
            ratings: []
        });

        console.log("ì°¨íŠ¸ìš© ë°ì´í„°:", chartData);

        alert("ì½˜ì†”ì—ì„œ reduceë¡œ ì§‘ê³„ëœ ë‹¤ì–‘í•œ í†µê³„ë¥¼ í™•ì¸í•˜ì„¸ìš”!");
    }

    function findMethods() {
        console.log("=== find, some, every: ê²€ìƒ‰ê³¼ ì¡°ê±´ í™•ì¸ ===");

        // ğŸ” ê²€ìƒ‰ ë©”ì„œë“œë“¤ì˜ íŠ¹ì§•
        // find: ì¡°ê±´ì— ë§ëŠ” ì²« ë²ˆì§¸ ìš”ì†Œ ë°˜í™˜ (ì—†ìœ¼ë©´ undefined)
        // some: í•˜ë‚˜ë¼ë„ ì¡°ê±´ì— ë§ìœ¼ë©´ true (OR ì—°ì‚°)
        // every: ëª¨ë‘ ì¡°ê±´ì— ë§ì•„ì•¼ true (AND ì—°ì‚°)
        // findIndex: ì¡°ê±´ì— ë§ëŠ” ì²« ë²ˆì§¸ ìš”ì†Œì˜ ì¸ë±ìŠ¤ ë°˜í™˜

        // 1ï¸âƒ£ find: íŠ¹ì • ìƒí’ˆ ì°¾ê¸°
        const laptop = products.find(product => product.name === "ë…¸íŠ¸ë¶");
        const expensiveProduct = products.find(product => product.price > 500000);
        const outOfStock = products.find(product => !product.inStock);

        console.log("ë…¸íŠ¸ë¶ ì°¾ê¸°:", laptop);
        console.log("50ë§Œì› ë„˜ëŠ” ìƒí’ˆ:", expensiveProduct || "ì—†ìŒ");
        console.log("í’ˆì ˆ ìƒí’ˆ:", outOfStock);

        // 2ï¸âƒ£ findIndex: ìš”ì†Œì˜ ìœ„ì¹˜ ì°¾ê¸°
        const keyboardIndex = products.findIndex(p => p.name === "í‚¤ë³´ë“œ");
        const highRatingIndex = products.findIndex(p => p.rating >= 4.5);

        console.log("í‚¤ë³´ë“œì˜ ìœ„ì¹˜:", keyboardIndex); // 2
        console.log("í‰ì  4.5 ì´ìƒ ìƒí’ˆì˜ ìœ„ì¹˜:", highRatingIndex);

        // 3ï¸âƒ£ some: í•˜ë‚˜ë¼ë„ ì¡°ê±´ì— ë§ëŠ”ì§€ í™•ì¸
        const hasExpensiveItem = products.some(p => p.price > 1000000);
        const hasOutOfStock = products.some(p => !p.inStock);
        const hasHighRating = products.some(p => p.rating >= 4.5);
        const hasFurniture = products.some(p => p.category === "ê°€êµ¬");

        console.log("100ë§Œì› ë„˜ëŠ” ìƒí’ˆ ìˆë‚˜?", hasExpensiveItem); // true
        console.log("í’ˆì ˆ ìƒí’ˆ ìˆë‚˜?", hasOutOfStock); // true  
        console.log("í‰ì  4.5 ì´ìƒ ìˆë‚˜?", hasHighRating); // true
        console.log("ê°€êµ¬ ìˆë‚˜?", hasFurniture); // true

        // 4ï¸âƒ£ every: ëª¨ë“  ìš”ì†Œê°€ ì¡°ê±´ì— ë§ëŠ”ì§€ í™•ì¸
        const allInStock = products.every(p => p.inStock);
        const allExpensive = products.every(p => p.price >= 50000);
        const allGoodRating = products.every(p => p.rating >= 4.0);
        const allElectronics = products.every(p => p.category === "ì „ìì œí’ˆ");

        console.log("ëª¨ë“  ìƒí’ˆì´ ì¬ê³  ìˆë‚˜?", allInStock); // false (ë§ˆìš°ìŠ¤ í’ˆì ˆ)
        console.log("ëª¨ë“  ìƒí’ˆì´ 5ë§Œì› ì´ìƒ?", allExpensive); // false (ë§ˆìš°ìŠ¤ 3.5ë§Œì›)
        console.log("ëª¨ë“  ìƒí’ˆì´ í‰ì  4.0 ì´ìƒ?", allGoodRating); // true
        console.log("ëª¨ë“  ìƒí’ˆì´ ì „ìì œí’ˆ?", allElectronics); // false (ì±…ìƒì´ ê°€êµ¬)

        // 5ï¸âƒ£ ì‹¤ë¬´ í™œìš©: ì¥ë°”êµ¬ë‹ˆ ìœ íš¨ì„± ê²€ì‚¬
        function validateCart(cartItems) {
            // ëª¨ë“  ìƒí’ˆì´ ì¬ê³  ìˆëŠ”ì§€ í™•ì¸
            const allItemsAvailable = cartItems.every(cartItem => {
                const product = products.find(p => p.id === cartItem.productId);
                return product && product.inStock;
            });

            // í•˜ë‚˜ë¼ë„ ê³ ê°€ ìƒí’ˆ(50ë§Œì› ì´ìƒ)ì´ ìˆëŠ”ì§€ í™•ì¸
            const hasExpensiveItem = cartItems.some(cartItem => {
                const product = products.find(p => p.id === cartItem.productId);
                return product && product.price >= 500000;
            });

            // ì´ ìƒí’ˆ ê°œìˆ˜ í™•ì¸
            const totalQuantity = cartItems.reduce((sum, item) => sum + item.quantity, 0);

            return {
                isValid: allItemsAvailable,
                hasExpensiveItem,
                totalQuantity,
                warnings: [
                    !allItemsAvailable && "ì¼ë¶€ ìƒí’ˆì´ í’ˆì ˆë˜ì—ˆìŠµë‹ˆë‹¤",
                    totalQuantity > 10 && "ìƒí’ˆ ê°œìˆ˜ê°€ ë„ˆë¬´ ë§ìŠµë‹ˆë‹¤ (ìµœëŒ€ 10ê°œ)",
                    hasExpensiveItem && "ê³ ê°€ ìƒí’ˆì´ í¬í•¨ë˜ì–´ ìˆìŠµë‹ˆë‹¤"
                ].filter(Boolean)
            };
        }

        // ì¥ë°”êµ¬ë‹ˆ í…ŒìŠ¤íŠ¸
        const testCart = [
            { productId: 1, quantity: 2 }, // ë…¸íŠ¸ë¶ (ì¬ê³  ìˆìŒ, ê³ ê°€)
            { productId: 2, quantity: 1 }, // ë§ˆìš°ìŠ¤ (í’ˆì ˆ)
            { productId: 3, quantity: 1 }  // í‚¤ë³´ë“œ (ì¬ê³  ìˆìŒ)
        ];

        const cartValidation = validateCart(testCart);
        console.log("ì¥ë°”êµ¬ë‹ˆ ê²€ì¦ ê²°ê³¼:", cartValidation);

        // 6ï¸âƒ£ ê³ ê¸‰ ê²€ìƒ‰: ë³µí•© ì¡°ê±´
        function advancedSearch(criteria) {
            return {
                // ì •í™•íˆ ì¼ì¹˜í•˜ëŠ” ìƒí’ˆ ì°¾ê¸°
                exact: products.find(p => 
                    (!criteria.name || p.name === criteria.name) &&
                    (!criteria.category || p.category === criteria.category) &&
                    (!criteria.minPrice || p.price >= criteria.minPrice)
                ),
                
                // ì¡°ê±´ì— ë§ëŠ” ìƒí’ˆì´ í•˜ë‚˜ë¼ë„ ìˆëŠ”ì§€
                hasMatch: products.some(p =>
                    (!criteria.maxPrice || p.price <= criteria.maxPrice) &&
                    (!criteria.minRating || p.rating >= criteria.minRating) &&
                    (!criteria.inStock || p.inStock)
                ),
                
                // ëª¨ë“  ìƒí’ˆì´ ì¡°ê±´ì„ ë§Œì¡±í•˜ëŠ”ì§€
                allMatch: products.every(p =>
                    (!criteria.minRating || p.rating >= criteria.minRating)
                )
            };
        }

        const searchResult = advancedSearch({
            category: "ì „ìì œí’ˆ",
            minPrice: 50000,
            maxPrice: 400000,
            minRating: 4.0,
            inStock: true
        });

        console.log("ê³ ê¸‰ ê²€ìƒ‰ ê²°ê³¼:", searchResult);

        // 7ï¸âƒ£ ì‹¤ë¬´ íŒ¨í„´: ë°ì´í„° ê²€ì¦
        function validateProductData(productList) {
            const validation = {
                // í•„ìˆ˜ í•„ë“œ ê²€ì‚¬
                hasRequiredFields: productList.every(p => 
                    p.id && p.name && p.price && p.category
                ),
                
                // ê°€ê²© ë²”ìœ„ ê²€ì‚¬
                hasValidPrices: productList.every(p => 
                    p.price > 0 && p.price <= 10000000
                ),
                
                // í‰ì  ë²”ìœ„ ê²€ì‚¬
                hasValidRatings: productList.every(p => 
                    p.rating >= 0 && p.rating <= 5
                ),
                
                // ì¤‘ë³µ ID ê²€ì‚¬
                hasUniqueIds: productList.length === 
                    new Set(productList.map(p => p.id)).size,
                
                // í’ˆì ˆ ìƒí’ˆ í™•ì¸
                hasOutOfStockItems: productList.some(p => !p.inStock)
            };

            validation.isValid = validation.hasRequiredFields && 
                               validation.hasValidPrices && 
                               validation.hasValidRatings && 
                               validation.hasUniqueIds;

            return validation;
        }

        const dataValidation = validateProductData(products);
        console.log("ìƒí’ˆ ë°ì´í„° ê²€ì¦:", dataValidation);

        alert("ì½˜ì†”ì—ì„œ ë‹¤ì–‘í•œ ê²€ìƒ‰ê³¼ ì¡°ê±´ í™•ì¸ ê²°ê³¼ë¥¼ í™•ì¸í•˜ì„¸ìš”!");
    }

    function springDataExample() {
    function springDataExample() {
        console.log("=== Spring ë°ì´í„° ì²˜ë¦¬ ì‹¤ë¬´ ì˜ˆì œ ===");

        // ğŸŒ± Spring Boot Controllerì—ì„œ ë°›ì€ ë°ì´í„°ë¥¼ ì²˜ë¦¬í•˜ëŠ” ì‹¤ë¬´ íŒ¨í„´
        // ì‹¤ì œ í”„ë¡œì íŠ¸ì—ì„œ ìì£¼ ë§ˆì£¼ì¹˜ëŠ” ë°ì´í„° ê°€ê³µ ì‹œë‚˜ë¦¬ì˜¤ë“¤

        // 1ï¸âƒ£ Spring Page ì‘ë‹µ ë°ì´í„° ì²˜ë¦¬
        // Spring Data JPAì˜ Page<T> ì‘ë‹µì„ í”„ë¡ íŠ¸ì—”ë“œì—ì„œ ì²˜ë¦¬
        const springPageResponse = {
            content: products, // ì‹¤ì œ ë°ì´í„°
            pageable: {
                pageNumber: 0,
                pageSize: 10,
                sort: { sorted: true, unsorted: false }
            },
            totalElements: 5,
            totalPages: 1,
            first: true,
            last: true,
            numberOfElements: 5
        };

        // Spring Page ë°ì´í„°ë¥¼ UI ì¹œí™”ì ìœ¼ë¡œ ë³€í™˜
        const processedPageData = {
            items: springPageResponse.content.map(item => ({
                ...item,
                displayPrice: item.price.toLocaleString() + "ì›",
                statusBadge: item.inStock ? "ì¬ê³ ìˆìŒ" : "í’ˆì ˆ",
                categoryKor: item.category === "ì „ìì œí’ˆ" ? "ì „ì" : "ê°€êµ¬"
            })),
            pagination: {
                currentPage: springPageResponse.pageable.pageNumber + 1, // Springì€ 0ë¶€í„°, UIëŠ” 1ë¶€í„°
                totalPages: springPageResponse.totalPages,
                totalItems: springPageResponse.totalElements,
                hasNext: !springPageResponse.last,
                hasPrev: !springPageResponse.first,
                itemsPerPage: springPageResponse.pageable.pageSize
            }
        };

        console.log("Spring Page ë°ì´í„° ì²˜ë¦¬:", processedPageData);

        // 2ï¸âƒ£ ê²€ìƒ‰ ë° í•„í„°ë§ (Spring @RequestParam ì²˜ë¦¬)
        // Spring Controllerì—ì„œ ê²€ìƒ‰ ì¡°ê±´ì„ ë°›ì•„ ì²˜ë¦¬í•˜ëŠ” íŒ¨í„´
        function processSearchRequest(searchParams) {
            let result = [...products]; // ì›ë³¸ ë³´í˜¸

            // í‚¤ì›Œë“œ ê²€ìƒ‰
            if (searchParams.keyword) {
                const keyword = searchParams.keyword.toLowerCase();
                result = result.filter(p => 
                    p.name.toLowerCase().includes(keyword) ||
                    p.category.toLowerCase().includes(keyword)
                );
            }

            // ê°€ê²© ë²”ìœ„ í•„í„°
            if (searchParams.minPrice) {
                result = result.filter(p => p.price >= parseInt(searchParams.minPrice));
            }
            if (searchParams.maxPrice) {
                result = result.filter(p => p.price <= parseInt(searchParams.maxPrice));
            }

            // ì¹´í…Œê³ ë¦¬ í•„í„°
            if (searchParams.category && searchParams.category !== "all") {
                result = result.filter(p => p.category === searchParams.category);
            }

            // ì¬ê³  í•„í„°
            if (searchParams.inStockOnly === "true") {
                result = result.filter(p => p.inStock);
            }

            // ì •ë ¬ ì²˜ë¦¬ (Spring Sort ë°©ì‹)
            if (searchParams.sort) {
                const [field, direction = "asc"] = searchParams.sort.split(",");
                result.sort((a, b) => {
                    let aVal = a[field];
                    let bVal = b[field];
                    
                    if (direction === "desc") {
                        return bVal > aVal ? 1 : -1;
                    }
                    return aVal > bVal ? 1 : -1;
                });
            }

            return result;
        }

        // ê²€ìƒ‰ ì‹œë‚˜ë¦¬ì˜¤ í…ŒìŠ¤íŠ¸
        const searchScenarios = [
            { keyword: "ë…¸íŠ¸ë¶", sort: "price,desc" },
            { category: "ì „ìì œí’ˆ", minPrice: "50000", inStockOnly: "true" },
            { maxPrice: "100000", sort: "rating,desc" }
        ];

        searchScenarios.forEach((params, index) => {
            const results = processSearchRequest(params);
            console.log(`ê²€ìƒ‰ ì‹œë‚˜ë¦¬ì˜¤ ${index + 1}:`, params, "ê²°ê³¼:", results.length + "ê°œ");
        });

        // 3ï¸âƒ£ í†µê³„ ëŒ€ì‹œë³´ë“œ ë°ì´í„° ìƒì„±
        // Spring Controllerì—ì„œ í†µê³„ APIë¥¼ í˜¸ì¶œí–ˆì„ ë•Œì˜ ë°ì´í„° ê°€ê³µ
        function generateDashboardStats(productList) {
            const stats = productList.reduce((acc, product) => {
                // ê¸°ë³¸ í†µê³„
                acc.totalProducts++;
                acc.totalValue += product.price;
                if (product.inStock) acc.inStockCount++;

                // ì¹´í…Œê³ ë¦¬ë³„ í†µê³„
                if (!acc.categories[product.category]) {
                    acc.categories[product.category] = {
                        count: 0,
                        value: 0,
                        avgRating: 0,
                        ratingSum: 0
                    };
                }
                acc.categories[product.category].count++;
                acc.categories[product.category].value += product.price;
                acc.categories[product.category].ratingSum += product.rating;

                // ê°€ê²© êµ¬ê°„ë³„ í†µê³„
                const priceRange = product.price < 100000 ? "low" : 
                                 product.price < 500000 ? "mid" : "high";
                acc.priceRanges[priceRange]++;

                return acc;
            }, {
                totalProducts: 0,
                totalValue: 0,
                inStockCount: 0,
                categories: {},
                priceRanges: { low: 0, mid: 0, high: 0 }
            });

            // í‰ê· ê°’ ê³„ì‚°
            stats.averagePrice = Math.round(stats.totalValue / stats.totalProducts);
            stats.stockRate = ((stats.inStockCount / stats.totalProducts) * 100).toFixed(1);

            // ì¹´í…Œê³ ë¦¬ë³„ í‰ê·  í‰ì  ê³„ì‚°
            Object.keys(stats.categories).forEach(category => {
                const cat = stats.categories[category];
                cat.avgRating = (cat.ratingSum / cat.count).toFixed(1);
                cat.avgPrice = Math.round(cat.value / cat.count);
            });

            return stats;
        }

        const dashboardStats = generateDashboardStats(products);
        console.log("ëŒ€ì‹œë³´ë“œ í†µê³„:", dashboardStats);

        // 4ï¸âƒ£ ì£¼ë¬¸ ì²˜ë¦¬ ì‹œìŠ¤í…œ
        // Spring @Transactional ë©”ì„œë“œì—ì„œ ì‚¬ìš©í•  ì£¼ë¬¸ ë°ì´í„° ê°€ê³µ
        function processOrderData(orderItems) {
            const orderSummary = orderItems.reduce((summary, item) => {
                const product = products.find(p => p.id === item.productId);
                
                if (!product) {
                    summary.errors.push(`ìƒí’ˆ ID ${item.productId}ë¥¼ ì°¾ì„ ìˆ˜ ì—†ìŠµë‹ˆë‹¤`);
                    return summary;
                }

                if (!product.inStock) {
                    summary.errors.push(`${product.name}ì€(ëŠ”) í’ˆì ˆì…ë‹ˆë‹¤`);
                    return summary;
                }

                const lineTotal = product.price * item.quantity;
                
                summary.items.push({
                    productId: product.id,
                    productName: product.name,
                    unitPrice: product.price,
                    quantity: item.quantity,
                    lineTotal: lineTotal
                });

                summary.subtotal += lineTotal;
                summary.totalQuantity += item.quantity;

                return summary;
            }, {
                items: [],
                subtotal: 0,
                totalQuantity: 0,
                errors: []
            });

            // í• ì¸ ë° ë°°ì†¡ë¹„ ê³„ì‚°
            if (orderSummary.errors.length === 0) {
                // VIP ê³ ê° í• ì¸ (100ë§Œì› ì´ìƒ ì£¼ë¬¸ ì‹œ 5% í• ì¸)
                orderSummary.discount = orderSummary.subtotal >= 1000000 ? 
                    Math.round(orderSummary.subtotal * 0.05) : 0;

                // ë°°ì†¡ë¹„ ê³„ì‚°
                orderSummary.shippingFee = orderSummary.subtotal >= 300000 ? 0 : 3000;

                // ìµœì¢… ê¸ˆì•¡
                orderSummary.total = orderSummary.subtotal - orderSummary.discount + orderSummary.shippingFee;

                // ì£¼ë¬¸ ë©”íƒ€ë°ì´í„°
                orderSummary.orderDate = new Date().toISOString();
                orderSummary.orderNumber = `ORD-${Date.now()}`;
            }

            return orderSummary;
        }

        // ì£¼ë¬¸ í…ŒìŠ¤íŠ¸
        const testOrder = [
            { productId: 1, quantity: 1 }, // ë…¸íŠ¸ë¶
            { productId: 3, quantity: 2 }, // í‚¤ë³´ë“œ 2ê°œ
            { productId: 4, quantity: 1 }  // ëª¨ë‹ˆí„°
        ];

        const orderResult = processOrderData(testOrder);
        console.log("ì£¼ë¬¸ ì²˜ë¦¬ ê²°ê³¼:", orderResult);

        // 5ï¸âƒ£ ì‹¤ì‹œê°„ ì¬ê³  ì—…ë°ì´íŠ¸ ì‹œë®¬ë ˆì´ì…˜
        // Spring WebSocketì´ë‚˜ Server-Sent Eventsë¡œ ë°›ì€ ì¬ê³  ì—…ë°ì´íŠ¸ ì²˜ë¦¬
        function updateInventory(inventoryUpdates) {
            const updatedProducts = products.map(product => {
                const update = inventoryUpdates.find(u => u.productId === product.id);
                
                if (update) {
                    return {
                        ...product,
                        inStock: update.quantity > 0,
                        stockQuantity: update.quantity,
                        lastUpdated: new Date().toISOString()
                    };
                }
                
                return product;
            });

            // ì¬ê³  ë³€ê²½ ìš”ì•½
            const changeSummary = inventoryUpdates.reduce((summary, update) => {
                const product = products.find(p => p.id === update.productId);
                if (product) {
                    const wasInStock = product.inStock;
                    const isInStock = update.quantity > 0;
                    
                    if (wasInStock && !isInStock) {
                        summary.outOfStock.push(product.name);
                    } else if (!wasInStock && isInStock) {
                        summary.backInStock.push(product.name);
                    }
                }
                return summary;
            }, {
                outOfStock: [],
                backInStock: []
            });

            return {
                products: updatedProducts,
                summary: changeSummary
            };
        }

        // ì¬ê³  ì—…ë°ì´íŠ¸ ì‹œë®¬ë ˆì´ì…˜
        const inventoryUpdates = [
            { productId: 2, quantity: 5 },  // ë§ˆìš°ìŠ¤ ì¬ì…ê³ 
            { productId: 5, quantity: 0 }   // ì±…ìƒ í’ˆì ˆ
        ];

        const inventoryResult = updateInventory(inventoryUpdates);
        console.log("ì¬ê³  ì—…ë°ì´íŠ¸ ê²°ê³¼:", inventoryResult);

        // 6ï¸âƒ£ ì¶”ì²œ ì‹œìŠ¤í…œ ë°ì´í„° ì²˜ë¦¬
        // Spring ML ì„œë¹„ìŠ¤ì—ì„œ ë°›ì€ ì¶”ì²œ ê²°ê³¼ë¥¼ ì²˜ë¦¬
        function processRecommendations(userId, userHistory) {
            // ì‚¬ìš©ì êµ¬ë§¤ ì´ë ¥ ë¶„ì„
            const userCategories = userHistory.map(h => h.category);
            const mostBoughtCategory = userCategories.reduce((freq, cat) => {
                freq[cat] = (freq[cat] || 0) + 1;
                return freq;
            }, {});

            const preferredCategory = Object.keys(mostBoughtCategory)
                .reduce((a, b) => mostBoughtCategory[a] > mostBoughtCategory[b] ? a : b);

            // ì¶”ì²œ ìƒí’ˆ ìƒì„±
            const recommendations = products
                .filter(p => p.inStock) // ì¬ê³  ìˆëŠ” ê²ƒë§Œ
                .filter(p => !userHistory.some(h => h.productId === p.id)) // êµ¬ë§¤í•œ ì  ì—†ëŠ” ê²ƒë§Œ
                .map(p => ({
                    ...p,
                    score: calculateRecommendationScore(p, preferredCategory, userHistory),
                    reason: getRecommendationReason(p, preferredCategory)
                }))
                .sort((a, b) => b.score - a.score) // ì ìˆ˜ ë†’ì€ ìˆœ
                .slice(0, 3); // ìƒìœ„ 3ê°œë§Œ

            return {
                userId,
                preferredCategory,
                recommendations,
                totalRecommendations: recommendations.length
            };
        }

        function calculateRecommendationScore(product, preferredCategory, userHistory) {
            let score = product.rating * 20; // ê¸°ë³¸ ì ìˆ˜ (í‰ì  ê¸°ë°˜)
            
            // ì„ í˜¸ ì¹´í…Œê³ ë¦¬ ë³´ë„ˆìŠ¤
            if (product.category === preferredCategory) score += 30;
            
            // ê°€ê²©ëŒ€ ë³´ë„ˆìŠ¤ (ì‚¬ìš©ì êµ¬ë§¤ ì´ë ¥ í‰ê· ê°€ ê³ ë ¤)
            const avgUserPrice = userHistory.reduce((sum, h) => sum + h.price, 0) / userHistory.length;
            if (Math.abs(product.price - avgUserPrice) < avgUserPrice * 0.3) score += 20;
            
            return Math.round(score);
        }

        function getRecommendationReason(product, preferredCategory) {
            if (product.category === preferredCategory) {
                return `ì„ í˜¸ ì¹´í…Œê³ ë¦¬(${preferredCategory}) ìƒí’ˆ`;
            }
            if (product.rating >= 4.5) {
                return "ê³ ê° ë§Œì¡±ë„ê°€ ë†’ì€ ìƒí’ˆ";
            }
            return "ì¸ê¸° ìƒí’ˆ";
        }

        // ì¶”ì²œ ì‹œìŠ¤í…œ í…ŒìŠ¤íŠ¸
        const userPurchaseHistory = [
            { productId: 1, category: "ì „ìì œí’ˆ", price: 1200000 },
            { productId: 3, category: "ì „ìì œí’ˆ", price: 89000 }
        ];

        const recommendations = processRecommendations(123, userPurchaseHistory);
        console.log("ìƒí’ˆ ì¶”ì²œ ê²°ê³¼:", recommendations);

        // ğŸ’¡ Spring ì—°ë™ ì‹¤ë¬´ íŒ
        console.log("=== ğŸ’¡ Spring ì—°ë™ ì‹¤ë¬´ íŒ ===");
        console.log("1. Page<T> ì‘ë‹µì€ content ë°°ì—´ì„ ì£¼ë¡œ ì‚¬ìš©");
        console.log("2. ê²€ìƒ‰ íŒŒë¼ë¯¸í„°ëŠ” URL ì¿¼ë¦¬ìŠ¤íŠ¸ë§ìœ¼ë¡œ Springì— ì „ë‹¬");
        console.log("3. ëŒ€ìš©ëŸ‰ ë°ì´í„°ëŠ” í´ë¼ì´ì–¸íŠ¸ì—ì„œ í˜ì´ì§• ì²˜ë¦¬");
        console.log("4. ì‹¤ì‹œê°„ ì—…ë°ì´íŠ¸ëŠ” WebSocket ë˜ëŠ” SSE í™œìš©");
        console.log("5. ë³µì¡í•œ í†µê³„ëŠ” Springì—ì„œ ê³„ì‚° í›„ í”„ë¡ íŠ¸ì—ì„œ ì‹œê°í™”");
        console.log("6. ì—ëŸ¬ ì²˜ë¦¬ ì‹œ Springì˜ @ExceptionHandler ì‘ë‹µ í˜•ì‹ ê³ ë ¤");

        alert("ì½˜ì†”ì—ì„œ Spring ë°ì´í„° ì²˜ë¦¬ ì‹¤ë¬´ ì˜ˆì œë¥¼ í™•ì¸í•˜ì„¸ìš”!");
    }
</script>
</body>
</html>